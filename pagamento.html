<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roleta - T√©cnica Xingondo</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
      max-width: 100vw;
    }
    .container {
      max-width: 600px;
      margin: 40px auto 60px;
      text-align: center;
      user-select: none;
    }
    h1 {
      color: red;
      margin-bottom: 30px;
    }
    /* Roleta */
    #roleta {
      margin: 0 auto;
      display: block;
      cursor: pointer;
      max-width: 100%;
      height: auto;
    }
    /* Ponteiro fixo - uma seta preta apontando para baixo no topo da roleta */
    .ponteiro {
      position: relative;
      width: 0; 
      height: 0; 
      margin: 0 auto 20px;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 30px solid black;
      filter: drop-shadow(0 0 3px black);
      z-index: 10;
    }
    /* Mensagem ap√≥s o resultado */
    #mensagem {
      margin-top: 30px;
      font-size: 22px;
      color: limegreen;
      font-weight: bold;
      min-height: 50px;
      animation: piscar 1s infinite alternate;
      display: none;
    }
    @keyframes piscar {
      0% {opacity: 1;}
      100% {opacity: 0.6;}
    }
    /* Destaque da fatia vencedora */
    .slice-winner {
      animation: destaque 1s ease-in-out infinite alternate;
      transform-origin: 50% 50%;
    }
    @keyframes destaque {
      0% {transform: scale(1);}
      100% {transform: scale(1.1);}
    }
    /* Bot√£o para girar */
    #btn-girar {
      background-color: red;
      border: none;
      color: white;
      font-size: 18px;
      padding: 12px 25px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 0 8px red;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #btn-girar:hover:not(:disabled) {
      background-color: #b20000;
    }
    #btn-girar:disabled {
      background-color: #660000;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Roleta T√©cnica Xingondo</h1>

    <div class="ponteiro" aria-hidden="true"></div>

    <svg id="roleta" width="400" height="400" viewBox="0 0 400 400" role="img" aria-label="Roleta de ofertas">
      <!-- As fatias da roleta ser√£o desenhadas via JS -->
    </svg>

    <button id="btn-girar" aria-live="polite">Girar a Roleta</button>

    <div id="mensagem" role="alert" aria-live="assertive"></div>
  </div>

  <script>
    const roletaSVG = document.getElementById('roleta');
    const btnGirar = document.getElementById('btn-girar');
    const mensagem = document.getElementById('mensagem');

    // Dados da roleta - os valores e cores (ajuste as cores se quiser)
    const segmentos = [
      {label: '1000 MT', color: '#e74c3c'},
      {label: '897 MT', color: '#f39c12'},
      {label: '800 MT', color: '#27ae60'},
      {label: '650 MT', color: '#2980b9'},
      {label: '500 MT', color: '#8e44ad'},
      {label: '197 MT', color: '#e67e22'}, // esse √© o valor vencedor
      {label: 'Girar de novo', color: '#7f8c8d'}
    ];

    const tamanho = 400;
    const raio = tamanho / 2;
    const centro = {x: raio, y: raio};
    const totalFatias = segmentos.length;
    const anguloPorFatias = 360 / totalFatias;

    // Para desenhar um arco circular na SVG
    function desenharFatias() {
      roletaSVG.innerHTML = ''; // Limpa tudo

      segmentos.forEach((segmento, i) => {
        const angIni = (anguloPorFatias * i) - 90;
        const angFim = angIni + anguloPorFatias;

        // Converter graus para radianos
        const radIni = (angIni * Math.PI) / 180;
        const radFim = (angFim * Math.PI) / 180;

        // Ponto inicial do arco na circunfer√™ncia
        const x1 = centro.x + raio * Math.cos(radIni);
        const y1 = centro.y + raio * Math.sin(radIni);

        // Ponto final do arco
        const x2 = centro.x + raio * Math.cos(radFim);
        const y2 = centro.y + raio * Math.sin(radFim);

        // Se o arco √© maior que 180 graus
        const largeArcFlag = anguloPorFatias > 180 ? 1 : 0;

        // Path do segmento da fatia
        const pathData = `
          M ${centro.x} ${centro.y}
          L ${x1} ${y1}
          A ${raio} ${raio} 0 ${largeArcFlag} 1 ${x2} ${y2}
          Z
        `;

        // Criar o path SVG para a fatia
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute('d', pathData);
        path.setAttribute('fill', segmento.color);
        path.setAttribute('data-index', i);
        path.setAttribute('class', 'slice');

        roletaSVG.appendChild(path);

        // Criar texto para a fatia
        const angMeio = angIni + anguloPorFatias / 2;
        const radMeio = (angMeio * Math.PI) / 180;
        const textoRaio = raio * 0.65;

        const tx = centro.x + textoRaio * Math.cos(radMeio);
        const ty = centro.y + textoRaio * Math.sin(radMeio);

        const textElem = document.createElementNS("http://www.w3.org/2000/svg", "text");
        textElem.setAttribute('x', tx);
        textElem.setAttribute('y', ty + 6); // ajuste vertical
        textElem.setAttribute('fill', 'white');
        textElem.setAttribute('font-size', '16');
        textElem.setAttribute('font-weight', 'bold');
        textElem.setAttribute('text-anchor', 'middle');
        textElem.setAttribute('pointer-events', 'none');
        textElem.textContent = segmento.label;

        roletaSVG.appendChild(textElem);
      });
    }

    desenharFatias();

    // Vari√°veis controle do giro
    let anguloAtual = 0;
    let girando = false;
    const fatiaVencedoraIndex = segmentos.findIndex(s => s.label.includes('197 MT'));

    function animarGiro(tempoTotal = 5000) {
      if (girando) return;
      girando = true;
      btnGirar.disabled = true;
      mensagem.style.display = 'none';
      mensagem.textContent = '';

      const voltasCompletas = 6; // quantas voltas completas a roleta dar√°
      // Calcular √¢ngulo final para parar na fatia do 197 MT
      // Queremos que o ponteiro esteja fixo no topo (√¢ngulo -90 graus)
      // Ent√£o a roleta deve parar com a fatia do 197 alinhada nesse ponto
      // Cada fatia come√ßa em: i * anguloPorFatias - 90 graus
      // Para alinhar o meio da fatia no ponteiro, vamos usar o meio do √¢ngulo da fatia
      const anguloFatia = anguloPorFatias * fatiaVencedoraIndex;
      const anguloMeioFatia = anguloFatia + anguloPorFatias / 2;

      // Como o ponteiro est√° no topo -90¬∞, a roleta deve girar de modo que o meio da fatia fique alinhado a -90¬∞
      // Logo, √¢ngulo final da roleta = 360*voltas - (anguloMeioFatia - 90)
      const anguloFinal = 360 * voltasCompletas - (anguloMeioFatia - 90);

      const startTime = performance.now();

      function passoAnimacao(time) {
        let tempoDecorrido = time - startTime;
        if (tempoDecorrido > tempoTotal) tempoDecorrido = tempoTotal;

        // Movimento ease-out (desacelerando)
        const progresso = tempoDecorrido / tempoTotal;
        const angulo = anguloAtual + anguloFinal * (1 - Math.pow(1 - progresso, 3));

        roletaSVG.style.transform = `rotate(${angulo}deg)`;

        if (tempoDecorrido < tempoTotal) {
          requestAnimationFrame(passoAnimacao);
        } else {
          anguloAtual = (anguloAtual + anguloFinal) % 360;
          girando = false;
          btnGirar.disabled = false;

          // Destacar fatia vencedora
          destacarFatia(fatiaVencedoraIndex);

          // Mostrar mensagem
          mensagem.textContent = 'üéâ Parab√©ns! Voc√™ conseguiu a oferta de 197 MT. V√°lida por 1 hora!';
          mensagem.style.display = 'block';
        }
      }
      requestAnimationFrame(passoAnimacao);
    }

    function destacarFatia(index) {
      // Remover destaque anterior
      document.querySelectorAll('.slice').forEach(slice => {
        slice.classList.remove('slice-winner');
      });
      // Colocar destaque na fatia vencedora
      const slice = roletaSVG.querySelector(`path[data-index="${index}"]`);
      if (slice) {
        slice.classList.add('slice-winner');
      }
    }

    btnGirar.addEventListener('click', () => {
      // Remover destaque e mensagem
      mensagem.style.display = 'none';
      mensagem.textContent = '';
      document.querySelectorAll('.slice').forEach(slice => {
        slice.classList.remove('slice-winner');
      });

      animarGiro();
    });
  </script>
</body>
</html>
